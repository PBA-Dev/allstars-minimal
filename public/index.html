<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allstars Wiki - Hauptseite</title>
    <!-- Add Quill Theme CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        /* Previous styles remain the same */
        :root {
            --primary-color: #06a454;
            --secondary-color: #06bafd;
            --accent-color: #f27326;
            --background-color: #f5f5f5;
            --text-color: #333;
            --border-color: #ddd;
        }

        /* Previous styles here... */

        /* Add Quill specific styles */
        #editor-container {
            height: 300px;
            margin-bottom: 20px;
        }

        .ql-editor {
            min-height: 200px;
            font-family: Arial, sans-serif;
        }

        .article-content {
            margin-top: 15px;
        }

        .article-content img {
            max-width: 100%;
            height: auto;
        }

        .article-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .article-content table td,
        .article-content table th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        /* Rest of previous styles... */
    </style>
</head>
<body>
    <div class="wiki-container">
        <!-- Header remains the same -->
        <header class="wiki-header">
            <!-- Previous header content -->
        </header>

        <main class="wiki-content">
            <div class="create-form">
                <h2>Neuen Artikel erstellen</h2>
                <form id="articleForm">
                    <input type="text" id="title" placeholder="Titel" required>
                    <!-- Replace textarea with Quill editor -->
                    <div id="editor-container"></div>
                    <input type="text" id="author" placeholder="Autor" required>
                    <button type="submit">Artikel erstellen</button>
                </form>
            </div>

            <h2>Artikel</h2>
            <div id="articles"></div>
        </main>

        <!-- Sidebar remains the same -->
        <aside class="wiki-sidebar">
            <!-- Previous sidebar content -->
        </aside>

        <!-- Footer remains the same -->
        <footer class="wiki-footer">
            <!-- Previous footer content -->
        </footer>
    </div>

    <!-- Add Quill JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        // Initialize Quill editor
        var quill = new Quill('#editor-container', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['link', 'image', 'code-block'],
                    ['clean']
                ]
            },
            placeholder: 'Artikelinhalt hier eingeben...'
        });

        // Load articles on page load
        window.onload = loadArticles;

        function loadArticles() {
            fetch('/api/articles')
                .then(response => response.json())
                .then(articles => {
                    const articlesDiv = document.getElementById('articles');
                    articlesDiv.innerHTML = '';
                    articles.forEach(article => {
                        const date = new Date(article.createdAt).toLocaleDateString('de-DE');
                        articlesDiv.innerHTML += `
                            <div class="article">
                                <h2>${article.title}</h2>
                                <div class="article-meta">
                                    Von ${article.author} am ${date}
                                </div>
                                <div class="article-content">
                                    ${article.content}
                                </div>
                            </div>
                        `;
                    });
                })
                .catch(error => console.error('Error loading articles:', error));
        }

        function loadRandomArticle() {
            fetch('/api/articles')
                .then(response => response.json())
                .then(articles => {
                    if (articles.length === 0) {
                        alert('Keine Artikel verf√ºgbar');
                        return;
                    }
                    const randomIndex = Math.floor(Math.random() * articles.length);
                    const article = articles[randomIndex];
                    const articlesDiv = document.getElementById('articles');
                    const date = new Date(article.createdAt).toLocaleDateString('de-DE');
                    articlesDiv.innerHTML = `
                        <div class="article">
                            <h2>${article.title}</h2>
                            <div class="article-meta">
                                Von ${article.author} am ${date}
                            </div>
                            <div class="article-content">
                                ${article.content}
                            </div>
                        </div>
                    `;
                })
                .catch(error => console.error('Error loading random article:', error));
        }

        // Handle form submission
        document.getElementById('articleForm').onsubmit = function(e) {
            e.preventDefault();
            
            const article = {
                title: document.getElementById('title').value,
                content: quill.root.innerHTML, // Get HTML content from Quill
                author: document.getElementById('author').value
            };

            fetch('/api/articles', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(article)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                loadArticles();
                document.getElementById('articleForm').reset();
                quill.setContents([]); // Clear Quill editor
            })
            .catch(error => console.error('Error:', error));
        };
    </script>
</body>
</html>
